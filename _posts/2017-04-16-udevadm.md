---
title: udev
published: false
categories: work
tags: tools
date: '2017-03-30 16:43:00 +0300'
---
### udev - management tool

Почему появилась статья:
Я бы хотел оставить себе задокументированное послание, которое легко можно было найти.
При этом мне придется обьяснить как себе, так и возможным читателям статьи как и почему указанное решение работает.

Решение проблемы:

`rm /etc/udev/rules.d/70-persistent-net.rules`

Описание проблемы:

В случае деградации железного сервера и последующей замены материнской платы или сетевых контроллеров или установки дисков в новую платформу, при загрузке сервера не произойдет корректной загрузки сети, т.к при использовании linux операционных систем в файле `/etc/udev/rules.d/70-persistent-net.rules` хранится информации о PCI-netwokr устройствах и для конкретных сетевых интерфейсов назначен mac-адрес, поэтому при загрузке операционной системы с подключенным новым устройством ядро при инициилизации устройств проверяет записи существующих ранее устройства в каталоге /sys/devices и соответсвенно находит конфигурацию прежнего с сетевого контроллера(интерфейса) с прежним адресным пространством, но автоматически не переинициилизирует новое устройство, поэтому ядру следует дать понять что адресное пространство изменилось удалив указанный в решении конфигурационный файл, который будет сгенерирован при новой загрузке ядра, согласно правилам в исполняемом скрипте `/lib/udev/write_net_rules`.

Нужно сделать:
- провести эксперимент - при замене платформы не удалять файл, а запустить скрипт /lib/udev/write_net_rules
- провести эксперемент - при замене платформы запустить утилиту udevadm control с опцией --reload 

##Что такое udev?

udev - набор утилит для управления устройствами, используемая linux ядром начиная с версии 2.6, используется для всевозможных действий с подключаемыми устройствами, например такими как управление правами, переименование устройств, хранение информации об устройствах. Важно знать, что хранение информации происходит в файловой системе sysfs, где хранятся файлы содержащие атрибуты для устройств.
Для упрощения управления устройствами разработчиками sysfs было предложено правило, что в одном файле хранится один атрибут.

Подкаталоги каталога /sys:
- _block_ - Информация о блочных устройствах (например, о жестких дисках)
- _bus_ - Шины, известные ядру: PCI-E, SCSI, USB и др.
- _class_ - Дерево, организованное функциональными типами устройств, например устройства ввода и сетевые интерфейсы.
- _dev_ - Информация об устройствах, разделенная между символьными и блочными устройствами.
- _devices_ - Корректное представление (с точки зрения наследственности) всех обнаруженных устройств
- _firmware_ - Интерфейсы с такими зависимыми от платформы подсистемами, как ACPI
- _fs_ - Каталог для хранения некоторых (но не всех) файловых систем, известных ядру
- _kernel_ - Значение таких внутренних характеристик ядра, как кеш и виртуальная память
- _module_ - Динамические модули, загруженные ядром
- _power_ - Некоторые сведения о состоянии производительности системы (обычно не используется)


Первоначально информация о конфигурации устройств, если таковая существовала, хранилась в файловой системе /ргос. Хотя информация о процессах и ядре, связанная со временем выполнения, и в дальнейшем будет храниться в каталоге /ргос, предполагается, что со временем вся информация об устройствах будет перемещена в каталог /sys.



